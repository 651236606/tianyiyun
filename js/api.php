<?phperror_reporting(0); session_start();header("Content-type:text/html;charset=utf-8");include "api-login.php"; if(isset($_GET['login'])){	if($_GET['login'] == 0){	    login($_GET['username'],$_GET['password']);			}else{	    login($_GET['username'],$_GET['password'],$_GET['code']);		}	}function login($username,$password,$c = ""){	if($c == ""){	load();	$param = 'appKey=cloud&accountType=01&userName='.$username.'&password='.urlencode($password).'&validateCode=&captchaToken='.$_SESSION['captchaToken'].'&returnUrl='.urlencode($_SESSION['returnUrl']).'&mailSuffix=%40189.cn&dynamicCheck=FALSE&clientType=10010&cb_SaveName=0&isOauth2=false&state=&paramId='.$_SESSION['paramId'];	}else{	    $param = 'appKey=cloud&accountType=01&userName='.$username.'&password='.urlencode($password).'&validateCode='.$c.'&captchaToken='.$_SESSION['captchaToken'].'&returnUrl='.urlencode($_SESSION['returnUrl']).'&mailSuffix=%40189.cn&dynamicCheck=FALSE&clientType=10010&cb_SaveName=0&isOauth2=false&state=&paramId='.$_SESSION['paramId'];		}	$str = post_login("https://open.e.189.cn/api/logbox/oauth2/loginSubmit.do",$param,$_SESSION['url'],$_SESSION['cookie'].";".$_SESSION['main'],$_SESSION['lt']);	$s = getCookie($str);		$cookie =  $_SESSION['ck'].$s;		preg_match("/toUrl\":\"(([\s\S]+?))\"/",$str,$uu);		$info = getc($uu[1],$_SESSION['url'],$s.";".$_SESSION['main']);		$s =  getCookie($info);		$cookie =  $_SESSION['ck'].";".$s.";".$_SESSION['main'];		preg_match("/msg\":\"(([\s\S]+?))\"/",$str,$sd);    if(strstr($sd[1],"成功")){		$json = getList($cookie);		$usedSize = $json['usedSize'];		$quota = $json['quota'];		$uid = $username;		include "../save/config.php"; 		$db = new M($hostname,$username,$password,$database);		$sql = 'UPDATE `ty_user` SET cookie="'.$cookie.'",size="'.$usedSize.'",quota="'.$quota.'",cishu=0 WHERE uid="'.$uid.'"';		$db->query($sql);		$db->close();		echo json_encode(array("code"=>0,"msg"=>"获取cookie成功！"));			}else{		echo json_encode(array("code"=>1,"msg"=>"获取cookie失败，错误信息：".$sd[1]));		}}?>